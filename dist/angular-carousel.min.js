/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.5 - 2014-10-13
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselAutoSlide",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e=Math.round(1e3*parseFloat(d.rnCarouselAutoSlide)),f=increment=!1,g=c.children().length;b.carouselExposedIndex||(b.carouselExposedIndex=0),stopAutoplay=function(){angular.isDefined(f)&&a.cancel(f),f=void 0},increment=function(){b.carouselExposedIndex=b.carouselExposedIndex<g-1?b.carouselExposedIndex+1:0},restartTimer=function(){stopAutoplay(),f=a(increment,e)},b.$watch("carouselIndex",function(){restartTimer()}),restartTimer(),d.rnCarouselPauseOnHover&&"false"!=d.rnCarouselPauseOnHover&&(c.on("mouseenter",stopAutoplay),c.on("mouseleave",restartTimer)),b.$on("$destroy",function(){stopAutoplay(),c.off("mouseenter",stopAutoplay),c.off("mouseleave",restartTimer)})}}}]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index>0&&a.index--},a.next=function(){a.index<a.items.length-1&&a.index++}},templateUrl:"carousel-controls.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-controls.html",'<div class="rn-carousel-controls">\n  <span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span>\n  <span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span>\n</div>')}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},templateUrl:"carousel-indicators.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-indicators.html",'<div class="rn-carousel-indicator">\n <span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span>\n</div>')}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$rootScope",function(a,b,c,d,e,f){var g=0,h=75,i=275,j=75,k=.05,l=3,m=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame;return{restrict:"A",scope:!0,compile:function(n,o){var p,q,r=n.children()[0].attributes,s=!1,t=!1,u=!1;return n.addClass("rn-carousel-slides"),n.children().addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(a){var b=r[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(p=c[1],q=c[2],p)return angular.isDefined(o.rnCarouselBuffered)&&(t=!0,b.value=p+" in "+q+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),s=!0,!1}return!0}),function(n,o,p){function r(){for(var a=[],b=0;S>b;b++)a[b]=b;n.carouselIndicatorArray=a}function v(){var a=W.children();return K=0===a.length?W[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width}function w(){X.css("width","100%");var a=v();a&&X.css("width",a+"px")}function x(a){isNaN(a)&&(a=n.carouselIndex*K),R=a;var b=-Math.round(R);b+=n.carouselBufferIndex*K,W[0].style[L]=ab?"translate3d("+b+"px, 0, 0)":"translate("+b+"px, 0)"}function y(){var a,b;O&&(a=Date.now()-Q,b=O*Math.exp(-a/j),b>l||-l>b?(x(P-b),m(y)):B(P/K))}function z(a){return a>=S?S:0>=a?0:a}function A(){var a=0,b=(n.carouselBufferSize-1)/2;t&&(a=n.carouselIndex<=b?0:S<n.carouselBufferSize?0:n.carouselIndex>S-n.carouselBufferSize?S-n.carouselBufferSize:n.carouselIndex-b),n.carouselBufferIndex=a}function B(a,b){return isNaN(a)&&(a=n.carouselIndex),b?void H(null,null,a*K):(n.carouselIndex=z(a),V=n.carouselIndex,A(),"$apply"!==f.$$phase&&"$digest"!==f.$$phase&&(u?n.$apply():n.$digest()),void x())}function C(){return k*K}function D(a){T=!0,H({x:a.clientX,y:a.clientY},a)}function E(a){var b=a;return 0===n.carouselIndex?b=Math.max(-C(),b):n.carouselIndex===S-1&&(b=Math.min((S-1)*K+C(),b)),b}function F(a){return c.bind("mouseup",D),M=!0,N=a.x,O=0,Q=Date.now(),j=h,!1}function G(a){var b,c;return M&&(b=a.x,c=N-b,(c>2||-2>c)&&(T=!0,N=b,m(function(){x(E(R+c))}))),!1}function H(a,b,d){if(!b||T){c.unbind("mouseup",D),M=!1,T=!1,P=R,d&&(P=d);var e=C(),f=n.carouselIndex*K,g=f-P,h=-Math[g>=0?"ceil":"floor"](g/K),i=Math.abs(g)>e;h+n.carouselIndex>=S&&(h=S-1-n.carouselIndex),h+n.carouselIndex<0&&(h=-n.carouselIndex);var j=i?h:0;if(!d&&S>3){var k=j+n.carouselIndex,l=S-2,o=(k-1+l)%l;if(1>k||k>l){var p=1>k?S-1:0;x(p*K+(R-f)),k=o+1,n.carouselIndex=p,$(k),n.$apply()}}return P=(j+n.carouselIndex)*K,V=P/K,O=P-R,Q=Date.now(),m(y),!1}}function I(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",msTransform:"-ms-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}function J(){w(),B()}g++;var K,L,M,N,O,P,Q,R=0,S=0,T=!1,U=!0,V=0,W=o.wrap("<div id='carousel-"+g+"' class='rn-carousel-container'></div>"),X=W.parent();if((angular.isDefined(p.rnCarouselIndicator)||angular.isDefined(p.rnCarouselControl))&&(r(),n.$watch("carouselIndex",function(a){n.indicatorIndex=a,n.carouselExposedIndex=a}),n.$watch("indicatorIndex",function(a){B(a,!0)}),n.$watch("carouselExposedIndex",function(a){B(a,!0)})),angular.isDefined(p.rnCarouselPreventAnimation)&&(U=!1),angular.isDefined(p.rnCarouselIndicator)){var Y=e("<div id='carousel-"+g+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(n);X.append(Y)}if(angular.isDefined(p.rnCarouselControl)){var Z=e("<div id='carousel-"+g+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(n);X.append(Z)}if(n.carouselBufferIndex=0,n.carouselBufferSize=5,n.carouselIndex=0,p.rnCarouselIndex){var $=function(a){_.assign(n.$parent,a)},_=d(p.rnCarouselIndex);angular.isFunction(_.assign)?(n.$watch("carouselIndex",function(a){$(a)}),n.carouselIndex=_(n),n.$parent.$watch(_,function(a){if(void 0!==a){if(0===S)return n.carouselIndex=a,void(V=n.carouselIndex);if(a===n.carouselIndex)return;if(a>=S?(a=S-1,$(a)):0>a&&(a=0,$(a)),j=i,S>3){var b=S-2;if(1>a||a>b){var c=V*K,d=1>a?S-1:0,e=(a-1+b)%b;x(d*K+(R-c)),a=e+1,$(a),n.carouselIndex=a}B(a,U)}}}),u=!0):isNaN(p.rnCarouselIndex)||(n.carouselIndex=parseInt(p.rnCarouselIndex,10))}s?n.$watchCollection(q,function(a){S=0,angular.isArray(a)?S=a.length:angular.isObject(a)&&(S=Object.keys(a).length),r(),K?B(n.carouselIndex):setTimeout(function(){w(),B(n.carouselIndex)})}):(S=o.children().length,r(),w()),p.$observe("rnCarouselSwipe",function(b){"false"!==b&&"off"!==b?a.bind(W,{start:F,move:G,end:H,cancel:function(a){H({},a)}}):W.unbind()}),p.$observe("rnCarouselPreventAnimation",function(a){U="false"!==a}),u||B(n.carouselIndex),L="transform",["webkit","Moz","O","ms"].every(function(a){var b=a+"Transform";return"undefined"!=typeof document.body.style[b]?(L=b,!1):!0});var ab=I(),bb=angular.element(b);bb.bind("orientationchange",J),bb.bind("resize",J),n.$on("$destroy",function(){c.unbind("mouseup",D),bb.unbind("orientationchange",J),bb.unbind("resize",J)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();